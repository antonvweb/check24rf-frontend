import React, {useEffect, useRef} from "react";
import styles from '@/styles/profile/checkList/ContextMenu.module.css'

interface ContextMenuProps {
    isVisible: boolean;
    x: number;
    y: number;
    onClose: () => void;
    actions: { label: string; onClick: () => void }[];
}

const svgForActions = [
    (<svg key={1} xmlns="http://www.w3.org/2000/svg" width="11" height="12" viewBox="0 0 11 12" fill="none">
        <path d="M1.26923 11.5C0.93261 11.5 0.609776 11.3663 0.371749 11.1283C0.133722 10.8902 0 10.5674 0 10.2308V1.76923C0 1.43261 0.133722 1.10978 0.371749 0.871749C0.609776 0.633722 0.93261 0.5 1.26923 0.5H8.03846C8.15067 0.5 8.25828 0.544574 8.33762 0.623916C8.41696 0.703259 8.46154 0.81087 8.46154 0.923077C8.46154 1.03528 8.41696 1.1429 8.33762 1.22224C8.25828 1.30158 8.15067 1.34615 8.03846 1.34615H1.26923C1.15702 1.34615 1.04941 1.39073 0.97007 1.47007C0.890728 1.54941 0.846154 1.65702 0.846154 1.76923V10.2308C0.846154 10.343 0.890728 10.4506 0.97007 10.5299C1.04941 10.6093 1.15702 10.6538 1.26923 10.6538H9.73077C9.84298 10.6538 9.95059 10.6093 10.0299 10.5299C10.1093 10.4506 10.1538 10.343 10.1538 10.2308V6C10.1538 5.88779 10.1984 5.78018 10.2778 5.70084C10.3571 5.6215 10.4647 5.57692 10.5769 5.57692C10.6891 5.57692 10.7967 5.6215 10.8761 5.70084C10.9554 5.78018 11 5.88779 11 6V10.2308C11 10.5674 10.8663 10.8902 10.6283 11.1283C10.3902 11.3663 10.0674 11.5 9.73077 11.5H1.26923Z" fill="#2E374F"/>
        <path d="M5.15343 7.37149L10.88 1.24766C10.9181 1.20699 10.9482 1.15871 10.9688 1.10557C10.9894 1.05244 11 0.995484 11 0.937969C11 0.880454 10.9894 0.823502 10.9688 0.770366C10.9482 0.717229 10.9181 0.668947 10.88 0.628278C10.842 0.587609 10.7969 0.555348 10.7472 0.533338C10.6975 0.511328 10.6442 0.5 10.5904 0.5C10.5367 0.5 10.4834 0.511328 10.4337 0.533338C10.384 0.555348 10.3389 0.587609 10.3008 0.628278L4.86382 6.44329L2.69916 4.12761C2.66113 4.08694 2.61598 4.05468 2.56629 4.03267C2.5166 4.01066 2.46335 3.99933 2.40956 3.99933C2.35578 3.99933 2.30252 4.01066 2.25283 4.03267C2.20314 4.05468 2.15799 4.08694 2.11996 4.12761C2.08193 4.16828 2.05176 4.21656 2.03118 4.2697C2.01059 4.32283 2 4.37979 2 4.4373C2 4.49482 2.01059 4.55177 2.03118 4.60491C2.05176 4.65804 2.08193 4.70632 2.11996 4.74699L4.57422 7.37149C4.61222 7.41223 4.65736 7.44455 4.70705 7.4666C4.75675 7.48865 4.81002 7.5 4.86382 7.5C4.91763 7.5 4.9709 7.48865 5.0206 7.4666C5.07029 7.44455 5.11543 7.41223 5.15343 7.37149Z" fill="#2E374F"/>
    </svg>),
    (<svg key={2} xmlns="http://www.w3.org/2000/svg" width="12" height="14" viewBox="0 0 12 14" fill="none">
        <path fillRule="evenodd" clipRule="evenodd" d="M2.0625 8.75C1.94647 8.75 1.83519 8.70391 1.75314 8.62186C1.67109 8.53981 1.625 8.42853 1.625 8.3125V1.3125C1.625 1.19647 1.67109 1.08519 1.75314 1.00314C1.83519 0.921094 1.94647 0.875 2.0625 0.875H9.9375C10.0535 0.875 10.1648 0.921094 10.2469 1.00314C10.3289 1.08519 10.375 1.19647 10.375 1.3125V8.3125C10.375 8.42853 10.3289 8.53981 10.2469 8.62186C10.1648 8.70391 10.0535 8.75 9.9375 8.75H8.1875C8.07147 8.75 7.96019 8.79609 7.87814 8.87814C7.79609 8.96019 7.75 9.07147 7.75 9.1875C7.75 9.30353 7.79609 9.41481 7.87814 9.49686C7.96019 9.57891 8.07147 9.625 8.1875 9.625H9.9375C10.2856 9.625 10.6194 9.48672 10.8656 9.24058C11.1117 8.99444 11.25 8.6606 11.25 8.3125V1.3125C11.25 0.964403 11.1117 0.630564 10.8656 0.384422C10.6194 0.138281 10.2856 0 9.9375 0L2.0625 0C1.7144 0 1.38056 0.138281 1.13442 0.384422C0.888281 0.630564 0.75 0.964403 0.75 1.3125V8.3125C0.75 8.6606 0.888281 8.99444 1.13442 9.24058C1.38056 9.48672 1.7144 9.625 2.0625 9.625H3.8125C3.92853 9.625 4.03981 9.57891 4.12186 9.49686C4.20391 9.41481 4.25 9.30353 4.25 9.1875C4.25 9.07147 4.20391 8.96019 4.12186 8.87814C4.03981 8.79609 3.92853 8.75 3.8125 8.75H2.0625Z" fill="#2E374F"/>
        <path fillRule="evenodd" clipRule="evenodd" d="M5.69031 13.8722C5.73095 13.913 5.77923 13.9453 5.83238 13.9674C5.88554 13.9894 5.94252 14.0008 6.00006 14.0008C6.05761 14.0008 6.11459 13.9894 6.16774 13.9674C6.2209 13.9453 6.26917 13.913 6.30981 13.8722L8.93481 11.2472C9.01696 11.1651 9.06312 11.0537 9.06312 10.9375C9.06312 10.8213 9.01696 10.7099 8.93481 10.6277C8.85266 10.5456 8.74124 10.4994 8.62506 10.4994C8.50889 10.4994 8.39746 10.5456 8.31531 10.6277L6.43756 12.5064V4.8125C6.43756 4.69647 6.39147 4.58519 6.30942 4.50314C6.22738 4.42109 6.1161 4.375 6.00006 4.375C5.88403 4.375 5.77275 4.42109 5.69071 4.50314C5.60866 4.58519 5.56256 4.69647 5.56256 4.8125V12.5064L3.68481 10.6277C3.60266 10.5456 3.49124 10.4994 3.37506 10.4994C3.25889 10.4994 3.14747 10.5456 3.06531 10.6277C2.98316 10.7099 2.93701 10.8213 2.93701 10.9375C2.93701 11.0537 2.98316 11.1651 3.06531 11.2472L5.69031 13.8722Z" fill="#2E374F"/>
    </svg>),
    (<svg key={3} xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none">
        <path d="M0 1.75C0 1.51794 0.0921872 1.29538 0.256282 1.13128C0.420376 0.967187 0.642936 0.875 0.875 0.875H13.125C13.3571 0.875 13.5796 0.967187 13.7437 1.13128C13.9078 1.29538 14 1.51794 14 1.75V3.5C14 3.73206 13.9078 3.95462 13.7437 4.11872C13.5796 4.28281 13.3571 4.375 13.125 4.375V10.9375C13.125 11.5177 12.8945 12.0741 12.4843 12.4843C12.0741 12.8945 11.5177 13.125 10.9375 13.125H3.0625C2.48234 13.125 1.92594 12.8945 1.5157 12.4843C1.10547 12.0741 0.875 11.5177 0.875 10.9375V4.375C0.642936 4.375 0.420376 4.28281 0.256282 4.11872C0.0921872 3.95462 0 3.73206 0 3.5V1.75ZM1.75 4.375V10.9375C1.75 11.2856 1.88828 11.6194 2.13442 11.8656C2.38056 12.1117 2.7144 12.25 3.0625 12.25H10.9375C11.2856 12.25 11.6194 12.1117 11.8656 11.8656C12.1117 11.6194 12.25 11.2856 12.25 10.9375V4.375H1.75ZM13.125 1.75H0.875V3.5H13.125V1.75ZM4.375 6.5625C4.375 6.44647 4.42109 6.33519 4.50314 6.25314C4.58519 6.17109 4.69647 6.125 4.8125 6.125H9.1875C9.30353 6.125 9.41481 6.17109 9.49686 6.25314C9.57891 6.33519 9.625 6.44647 9.625 6.5625C9.625 6.67853 9.57891 6.78981 9.49686 6.87186C9.41481 6.95391 9.30353 7 9.1875 7H4.8125C4.69647 7 4.58519 6.95391 4.50314 6.87186C4.42109 6.78981 4.375 6.67853 4.375 6.5625Z" fill="#2E374F"/>
    </svg>)
]

export const ContextMenu = ({isVisible, x, y, onClose, actions }: ContextMenuProps) => {
    const menuRef = useRef<HTMLDivElement>(null);
    useEffect(() => {
        const handleClickOutside = (event: MouseEvent) => {
            if (menuRef.current && !menuRef.current.contains(event.target as Node)) {
                onClose();
            }
        };

        if (isVisible) {
            document.addEventListener("mousedown", handleClickOutside);
        }

        return () => {
            document.removeEventListener("mousedown", handleClickOutside);
        };
    }, [isVisible, onClose]);

    return (
        <ul
            className={`${styles.menu} ${isVisible ? styles.open : ""}`}
            style={{
                top: y,
                left: x,
            }}
        >
            {actions.map((action, idx) => (
                <li
                    className={styles.menuItem}
                    key={idx}
                    onClick={() => {
                        action.onClick();
                        onClose();
                    }}
                >
                    {svgForActions[idx]}
                    {action.label}
                </li>
            ))}
        </ul>
    );
};